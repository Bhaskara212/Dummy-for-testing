name: CI - Tests

on:
  workflow_dispatch:
  push:
    branches: [ main ]
  pull_request:

jobs:
  tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17   # change to your version if needed

      - name: Run Unit + Integration Tests
        run: mvn -B verify --fail-at-end

      # âœ… Unit test results
      - name: Publish Unit Test Report
        uses: dorny/test-reporter@v1
        if: always()
        with:
          name: Unit Tests
          path: target/surefire-reports/*.xml
          reporter: java-junit

      # âœ… Integration test results
      - name: Publish Integration Test Report
        uses: dorny/test-reporter@v1
        if: always()
        with:
          name: Integration Tests
          path: target/failsafe-reports/*.xml
          reporter: java-junit

      # âœ… Summary in GitHub UI
      - name: Add Test Summary
        if: always()
        run: |
          echo "## ðŸ§ª Test Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- Unit test reports from \`target/surefire-reports\`" >> $GITHUB_STEP_SUMMARY
          echo "- Integration test reports from \`target/failsafe-reports\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "See the **Test Reports** section of this job for detailed failures with stacktraces." >> $GITHUB_STEP_SUMMARY
